---
title: "Tensor Diagrams"
description: |
  Description of Tensor Diagrams.
author:
  - name: Claudia Zendejas-Morales
    url: http://claudiazm.xyz
    affiliation: Quantum Flytrap
    affiliation_url: https://quantumflytrap.com
  - name: Piotr Migda≈Ç 
    url: https://p.migdal.pl
    affiliation: Quantum Flytrap
    affiliation_url: https://quantumflytrap.com
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    toc: true
    toc_float: true
    self_contained: false
creative_commons: CC BY
bibliography: refs.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo=FALSE, message=FALSE, results='asis'}
cat(
  "<script src='https://d3js.org/d3.v6.min.js'></script>",
  "<script src='tensorDiagram.js'></script>",
  "<link rel='stylesheet' href='tensorDiagram.css'>"
)
```

### Introduction

This is a proof of concept (POC) of the OnMouseOver event for the Tensor Diagrams, when this event happens the corresponding element in equation change its color in order to visualize the correlation.


### Multidimenstional arrays

Multidimenstional arrays are the basic building blocks for any deep neural network, and many other models in statistics and machine learning. However, even for relatively simple operations the notation becomes monstrous:

<div id="text" class="equation">
<div class="eq-elem">$$\sum_{ij}$$</div>
<div class="eq-elem">$$x_i$$</div>
<div class="eq-elem">$$A_{ij}$$</div>
<div class="eq-elem">$$B_{jk}$$</div>
</div>

### Tensor Diagrams

We present it as a convenient notation for matrix summation, nothing less more more. In this notation, the described equation becomes:

<div id="text" class="equation">
<div id="firstcontainer" class="eq-diagram">
<!--<svg width="220" height="115"></svg>-->
</div>
<div class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}\sum_{ij}$$</div>
<div id="v_x" class="eq-elem">$$x_i$$</div>
<div id="M_A" class="eq-elem">$$A_{ij}$$</div>
<div id="M_B" class="eq-elem">$$B_{jk}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors = [
	{ x: 0, y: 0, name: "x", idEqPart: "v_x" },
  { x: 1, y: 0, name: "A", idEqPart: "M_A" },
  { x: 2, y: 0, name: "B", idEqPart: "M_B" },
];

const contractions = [
	{ source: 0, target: 1 , name: "i" },
  { source: 1, target: 2 , name: "j" },
  { source: 2, target: "right", name: "k" },
];

drawDiagram(tensors, contractions, "firstcontainer", 220, 120);

```

You can hover your mouse over an element to see who is who in this diagram.


### Formulae from EINSUM IS ALL YOU NEED

#### Einsum notation

Multiply two matrices

<div id="text" class="equation">
<div id="einsumindl1" class="eq-diagram"></div>
<div id="einsumindl1_sum_ik" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}\sum_{ik}$$</div>
<div id="einsumindl1_A_ik" class="eq-elem">$$A_{ik}$$</div>
<div id="einsumindl1_B_kj" class="eq-elem">$$B_{kj}$$</div>
<div id="einsumindl1_eq" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}$$</div>
<div id="einsumindl1_A_ik" class="eq-elem">$${A^{i}}_{k}$$</div>
<div id="einsumindl1_B_kj" class="eq-elem">$${B^{k}}_{j}$$</div>
<div id="einsumindl1_c_j" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}c_{j}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsumindl1 = [
  { x: 1, y: 0, name: "A", idEqPart: "einsumindl1_A_ik" },
  { x: 2, y: 0, name: "B", idEqPart: "einsumindl1_B_kj" },
];

const contractions_einsumindl1 = [
	{ source: 0, target: "left", name: "i" },
  { source: 0, target: 1, name: "k" },
  { source: 1, target: "right", name: "j" },
];

drawDiagram(tensors_einsumindl1, contractions_einsumindl1, "einsumindl1", 220, 120);

```

Dot product of two vectors

<div id="text" class="equation">
<div id="einsumindl2" class="eq-diagram"></div>
<div id="einsumindl2_sum_i" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}\sum_{i}$$</div>
<div id="einsumindl2_a_i" class="eq-elem">$$a_{i}$$</div>
<div id="einsumindl2_b_i" class="eq-elem">$$b_{i}$$</div>
<div id="einsumindl2_eq" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}$$</div>
<div id="einsumindl2_a_i" class="eq-elem">$$a_{i}$$</div>
<div id="einsumindl2_b_i" class="eq-elem">$$b^{i}$$</div>
<div id="einsumindl2_c" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}c$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsumindl2 = [
  { x: 0, y: 0, name: "a", idEqPart: "einsumindl2_a_i" },
  { x: 1, y: 0, name: "b", idEqPart: "einsumindl2_b_i" },
];

const contractions_einsumindl2 = [
  { source: 0, target: 1, name: "i" },
];

drawDiagram(tensors_einsumindl2, contractions_einsumindl2, "einsumindl2", 100, 120);

```

Applying a transformation to vectors in a higher-order tensor

<div id="text" class="equation">
<div id="einsumindl3" class="eq-diagram"></div>
<div id="einsumindl3_sum_k" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}\sum_{k}$$</div>
<div id="einsumindl3_T_ntk" class="eq-elem">$$T_{ntk}$$</div>
<div id="einsumindl3_W_kq" class="eq-elem">$$W_{kq}$$</div>
<div id="einsumindl3_eq" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}$$</div>
<div id="einsumindl3_T_ntk" class="eq-elem">$${T^{nt}}_{k}$$</div>
<div id="einsumindl3_W_kq" class="eq-elem">$${W^{k}}_{q}$$</div>
<div id="einsumindl3_C_ntq" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}C_{ntq}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsumindl3 = [
  { x: 1, y: 0, name: "T", idEqPart: "einsumindl3_T_ntk" },
  { x: 2, y: 0, name: "W", idEqPart: "einsumindl3_W_kq" },
];

const contractions_einsumindl3 = [
	{ source: 0, target: "left", name: "n" },
	{ source: 0, target: "down", name: "t" },
  { source: 0, target: 1, name: "k" },
  { source: 1, target: "right", name: "q" },
];

drawDiagram(tensors_einsumindl3, contractions_einsumindl3, "einsumindl3", 220, 130);

```

Order-4 tensor and project vectors in the 3rd dimension

<div id="text" class="equation">
<div id="einsumindl4" class="eq-diagram"></div>
<div id="einsumindl4_sum_tk" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}\sum_{tk}$$</div>
<div id="einsumindl4_T_ntkm" class="eq-elem">$$T_{ntkm}$$</div>
<div id="einsumindl4_W_kq" class="eq-elem">$$W_{kq}$$</div>
<div id="einsumindl4_eq" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}$$</div>
<div id="einsumindl4_T_ntkm" class="eq-elem">$${T^{ntm}}_{k}$$</div>
<div id="einsumindl4_W_kq" class="eq-elem">$${W^{k}}_{q}$$</div>
<div id="einsumindl4_C_mqn" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}C_{mqn}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsumindl4 = [
  { x: 1, y: 0, name: "T", idEqPart: "einsumindl4_T_ntkm", labPos: "leftup" },
  { x: 2, y: 0, name: "W", idEqPart: "einsumindl4_W_kq" },
];

const contractions_einsumindl4 = [
	{ source: 0, target: "left", name: "n" },
	{ source: 0, target: "down", name: "t" },
  { source: 0, target: 1, name: "k" },
  { source: 0, target: "up", name: "m" },
  { source: 1, target: "right", name: "q" },
];

drawDiagram(tensors_einsumindl4, contractions_einsumindl4, "einsumindl4", 220, 140);

```

#### All you need: einsum in ...

Matrix transpose

<div id="text" class="equation">
<div id="einsumindl5_1" class="eq-diagram"></div>
<div id="einsumindl5_eq1" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}$$</div>
<div id="einsumindl5_2" class="eq-diagram"></div>
<div id="einsumindl5_right" class="eq-elem">$$\hspace{0.3cm}\rightarrow\hspace{0.3cm}$$</div>
<div id="einsumindl5_B_ji" class="eq-elem">$$B_{ji}$$</div>
<div id="einsumindl5_eq2" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}$$</div>
<div id="einsumindl5_A_ij" class="eq-elem">$$A_{ij}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsumindl5_1 = [
  { x: 1, y: 0, name: "B", idEqPart: "einsumindl5_B_ji" },
];

const contractions_einsumindl5_1 = [
	{ source: 0, target: "left", name: "j" },
  { source: 0, target: "right", name: "i" },
];

const tensors_einsumindl5_2 = [
  { x: 1, y: 0, name: "A", idEqPart: "einsumindl5_A_ij" },
];

const contractions_einsumindl5_2 = [
	{ source: 0, target: "left", name: "i" },
  { source: 0, target: "right", name: "j" },
];

drawDiagram(tensors_einsumindl5_1, contractions_einsumindl5_1, "einsumindl5_1", 160, 110, 1);
drawDiagram(tensors_einsumindl5_2, contractions_einsumindl5_2, "einsumindl5_2", 160, 110, 2);

```

Sum

<div id="text" class="equation">
<div id="einsumindl6" class="eq-diagram"></div>
<div id="einsumindl6_sum_ij" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}\sum_{ij}$$</div>
<div id="einsumindl6_A_ij" class="eq-elem">$$A_{ij}$$</div>
<div id="einsumindl6_eq" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}$$</div>
<div id="einsumindl6_A_ij" class="eq-elem">$$A_{ij}$$</div>
<div id="einsumindl6_b" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}b$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsumindl6 = [
  { x: 1, y: 0, name: "A", idEqPart: "einsumindl6_A_ij" },
];

const contractions_einsumindl6 = [
	{ source: 0, target: "left", name: "i" },
  { source: 0, target: "right", name: "j" },
];

drawDiagram(tensors_einsumindl6, contractions_einsumindl6, "einsumindl6", 160, 120);

```

Column sum

<div id="text" class="equation">
<div id="einsumindl7" class="eq-diagram"></div>
<div id="einsumindl7_sum_i" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}\sum_{i}$$</div>
<div id="einsumindl7_A_ij" class="eq-elem">$$A_{ij}$$</div>
<div id="einsumindl7_eq" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}$$</div>
<div id="einsumindl7_A_ij" class="eq-elem">$$A_{ij}$$</div>
<div id="einsumindl7_b_j" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}b_{j}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsumindl7 = [
  { x: 1, y: 0, name: "A", idEqPart: "einsumindl7_A_ij" },
];

const contractions_einsumindl7 = [
	{ source: 0, target: "left", name: "i" },
  { source: 0, target: "right", name: "j" },
];

drawDiagram(tensors_einsumindl7, contractions_einsumindl7, "einsumindl7", 160, 120, 1);

```

Row sum

<div id="text" class="equation">
<div id="einsumindl8" class="eq-diagram"></div>
<div id="einsumindl8_sum_j" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}\sum_{j}$$</div>
<div id="einsumindl8_A_ij" class="eq-elem">$$A_{ij}$$</div>
<div id="einsumindl8_eq" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}$$</div>
<div id="einsumindl8_A_ij" class="eq-elem">$$A_{ij}$$</div>
<div id="einsumindl8_b_i" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}b_{i}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsumindl8 = [
  { x: 1, y: 0, name: "A", idEqPart: "einsumindl8_A_ij" },
];

const contractions_einsumindl8 = [
	{ source: 0, target: "left", name: "i" },
  { source: 0, target: "right", name: "j" },
];

drawDiagram(tensors_einsumindl8, contractions_einsumindl8, "einsumindl8", 160, 120, 2);

```

Matrix-vector multiplication

<div id="text" class="equation">
<div id="einsumindl9" class="eq-diagram"></div>
<div id="einsumindl9_sum_k" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}\sum_{k}$$</div>
<div id="einsumindl9_A_ik" class="eq-elem">$$A_{ik}$$</div>
<div id="einsumindl9_b_k" class="eq-elem">$$b_{k}$$</div>
<div id="einsumindl9_eq" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}$$</div>
<div id="einsumindl9_A_ik" class="eq-elem">$${A^{i}}_{k}$$</div>
<div id="einsumindl9_b_k" class="eq-elem">$$b^{k}$$</div>
<div id="einsumindl9_c_i" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}c_{i}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsumindl9 = [
  { x: 1, y: 0, name: "A", idEqPart: "einsumindl9_A_ik" },
  { x: 2, y: 0, name: "b", idEqPart: "einsumindl9_b_k" },
];

const contractions_einsumindl9 = [
	{ source: 0, target: "left", name: "i" },
  { source: 0, target: 1, name: "k" },
];

drawDiagram(tensors_einsumindl9, contractions_einsumindl9, "einsumindl9", 170, 120);

```

Matrix-matrix multiplication

<div id="text" class="equation">
<div id="einsumindl10" class="eq-diagram"></div>
<div id="einsumindl10_sum_ik" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}\sum_{k}$$</div>
<div id="einsumindl10_A_ik" class="eq-elem">$$A_{ik}$$</div>
<div id="einsumindl10_B_kj" class="eq-elem">$$B_{kj}$$</div>
<div id="einsumindl10_eq" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}$$</div>
<div id="einsumindl10_A_ik" class="eq-elem">$${A^{i}}_{k}$$</div>
<div id="einsumindl10_B_kj" class="eq-elem">$${B^{k}}_{j}$$</div>
<div id="einsumindl10_C_ij" class="eq-elem">$$\hspace{0.3cm}=\hspace{0.3cm}C_{ij}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsumindl10 = [
  { x: 1, y: 0, name: "A", idEqPart: "einsumindl10_A_ik" },
  { x: 2, y: 0, name: "B", idEqPart: "einsumindl10_B_kj" },
];

const contractions_einsumindl10 = [
	{ source: 0, target: "left", name: "i" },
  { source: 0, target: 1, name: "k" },
  { source: 1, target: "right", name: "j" },
];

drawDiagram(tensors_einsumindl10, contractions_einsumindl10, "einsumindl10", 220, 120);

```