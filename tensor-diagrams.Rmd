---
title: "Tensor Diagrams"
description: |
  Description of Tensor Diagrams.
author:
  - name: Claudia Zendejas-Morales
    url: http://claudiazm.xyz
    affiliation: Quantum Flytrap
    affiliation_url: https://quantumflytrap.com
  - name: Piotr Migda≈Ç 
    url: https://p.migdal.pl
    affiliation: Quantum Flytrap
    affiliation_url: https://quantumflytrap.com
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    toc: true
    toc_float: true
    self_contained: false
creative_commons: CC BY
bibliography: refs.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo=FALSE, message=FALSE, results='asis'}
cat(
  "<script src='https://d3js.org/d3.v6.min.js'></script>",
  "<script src='tensorDiagram.js'></script>",
  "<link rel='stylesheet' href='tensorDiagram.css'>"
)
```

### Introduction

This is a proof of concept (POC) of the OnMouseOver event for the Tensor Diagrams, when this event happens the corresponding element in equation change its color in order to visualize the correlation.


### Multidimenstional arrays

Multidimenstional arrays are the basic building blocks for any deep neural network, and many other models in statistics and machine learning. However, even for relatively simple operations the notation becomes monstrous:

<div id="text" class="equation">
<div class="eq-elem">$$\sum_{ij}$$</div>
<div class="eq-elem">$$x_i$$</div>
<div class="eq-elem">$$A_{ij}$$</div>
<div class="eq-elem">$$B_{jk}$$</div>
</div>

### Tensor Diagrams

We present it as a convenient notation for matrix summation, nothing less more more. In this notation, the described equation becomes:

<div id="text" class="equation">
<div id="firstcontainer" class="eq-diagram">
<!--<svg width="220" height="115"></svg>-->
</div>
<div class="eq-elem">$$\hspace{0.5cm}=\hspace{0.5cm}\sum_{ij}$$</div>
<div id="v_x" class="eq-elem">$$x_i$$</div>
<div id="M_A" class="eq-elem">$$A_{ij}$$</div>
<div id="M_B" class="eq-elem">$$B_{jk}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors = [
	{ x: 0, y: 0, name: "x", idEqPart: "v_x" },
  { x: 1, y: 0, name: "A", idEqPart: "M_A" },
  { x: 2, y: 0, name: "B", idEqPart: "M_B" },
];

const contractions = [
	{ source: 0, target: 1 , name: "i" },
  { source: 1, target: 2 , name: "j" },
  { source: 2, target: "right", name: "k" },
];

drawDiagram(tensors, contractions, "firstcontainer", 220, 115);

```

You can hover your mouse over an element to see who is who in this diagram.


### Formulae from EINSUM IS ALL YOU NEED

Multiply two matrices

<div id="text" class="equation">
<div id="einsum1" class="eq-diagram"></div>
<div id="einsum1_c_j" class="eq-elem">$$\hspace{0.5cm}=\hspace{0.5cm}\sum_{ik}$$</div>
<div id="einsum1_M_A" class="eq-elem">$$A_{ik}$$</div>
<div id="einsum1_M_B" class="eq-elem">$$B_{kj}$$</div>
<div id="einsum1_eq" class="eq-elem">$$\hspace{0.5cm}=\hspace{0.5cm}$$</div>
<div id="einsum1_M_A" class="eq-elem">$$A_{ik}$$</div>
<div id="einsum1_M_B" class="eq-elem">$$B_{kj}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsum1 = [
  { x: 1, y: 0, name: "A", idEqPart: "einsum1_M_A" },
  { x: 2, y: 0, name: "B", idEqPart: "einsum1_M_B" },
];

const contractions_einsum1 = [
	{ source: 0, target: "left", name: "i" },
  { source: 0, target: 1, name: "k" },
  { source: 1, target: "right", name: "j" },
];

drawDiagram(tensors_einsum1, contractions_einsum1, "einsum1", 220, 115);

```

Dot product of two vectors

<div id="text" class="equation">
<div id="einsum2" class="eq-diagram"></div>
<div id="einsum2_c" class="eq-elem">$$\hspace{0.5cm}=\hspace{0.5cm}\sum_{i}$$</div>
<div id="einsum2_a_i" class="eq-elem">$$a_{i}$$</div>
<div id="einsum2_b_i" class="eq-elem">$$b_{i}$$</div>
<div id="einsum2_eq" class="eq-elem">$$\hspace{0.5cm}=\hspace{0.5cm}$$</div>
<div id="einsum2_a_i" class="eq-elem">$$a_{i}$$</div>
<div id="einsum2_b_i" class="eq-elem">$$b_{i}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsum2 = [
  { x: 0, y: 0, name: "a", idEqPart: "einsum2_a_i" },
  { x: 1, y: 0, name: "b", idEqPart: "einsum2_b_i" },
];

const contractions_einsum2 = [
  { source: 0, target: 1, name: "i" },
];

drawDiagram(tensors_einsum2, contractions_einsum2, "einsum2", 100, 115);

```

Applying a transformation to a vector

<div id="text" class="equation">
<div id="einsum3" class="eq-diagram"></div>
<div id="einsum3_C_ntq" class="eq-elem">$$\hspace{0.5cm}=\hspace{0.5cm}\sum_{k}$$</div>
<div id="einsum3_T_ntk" class="eq-elem">$$T_{ntk}$$</div>
<div id="einsum3_W_kq" class="eq-elem">$$W_{kq}$$</div>
<div id="einsum3_eq" class="eq-elem">$$\hspace{0.5cm}=\hspace{0.5cm}$$</div>
<div id="einsum3_T_ntk" class="eq-elem">$$T_{ntk}$$</div>
<div id="einsum3_W_kq" class="eq-elem">$$W_{kq}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsum3 = [
  { x: 1, y: 0, name: "T", idEqPart: "einsum3_T_ntk" },
  { x: 2, y: 0, name: "W", idEqPart: "einsum3_W_kq" },
];

const contractions_einsum3 = [
	{ source: 0, target: "left", name: "n" },
	{ source: 0, target: "down", name: "t" },
  { source: 0, target: 1, name: "k" },
  { source: 1, target: "right", name: "q" },
];

drawDiagram(tensors_einsum3, contractions_einsum3, "einsum3", 220, 130);

```

Order-4 tensor and project vectors in the 3rd dimension

<div id="text" class="equation">
<div id="einsum4" class="eq-diagram"></div>
<div id="einsum4_C_mqn" class="eq-elem">$$\hspace{0.5cm}=\hspace{0.5cm}\sum_{tk}$$</div>
<div id="einsum4_T_ntkm" class="eq-elem">$$T_{ntkm}$$</div>
<div id="einsum4_W_kq" class="eq-elem">$$W_{kq}$$</div>
<div id="einsum4_eq" class="eq-elem">$$\hspace{0.5cm}=\hspace{0.5cm}$$</div>
<div id="einsum4_T_ntkm" class="eq-elem">$$T_{ntkm}$$</div>
<div id="einsum4_W_kq" class="eq-elem">$$W_{kq}$$</div>
</div>

```{js, results='asis', echo=FALSE, message=FALSE}

const tensors_einsum4 = [
  { x: 1, y: 0, name: "T", idEqPart: "einsum4_T_ntkm" },
  { x: 2, y: 0, name: "W", idEqPart: "einsum4_W_kq" },
];

const contractions_einsum4 = [
	{ source: 0, target: "left", name: "n" },
	{ source: 0, target: "down", name: "t" },
  { source: 0, target: 1, name: "k" },
  { source: 0, target: "up", name: "m" },
  { source: 1, target: "right", name: "q" },
];

drawDiagram(tensors_einsum4, contractions_einsum4, "einsum4", 220, 160);

```
